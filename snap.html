<!DOCTYPE html>
<html>
    <head>
        <title>Snap! Build Your Own Blocks</title>
        <link rel="icon" href="src/favicon.ico" type="image/x-icon">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <script src="src/poly.js?version=2023-05-24"></script>
        <script src="src/typedarrays.js?version=2023-05-24"></script>
        <script src="src/excanvas.js?version=2023-05-24"></script>

        <script src="src/morphic.js?version=2023-11-07"></script>
        <script src="src/symbols.js?version=2023-07-13"></script>
        <script src="src/widgets.js?version=2023-05-24"></script>
        <script src="src/blocks.js?version=2023-11-24"></script>
        <script src="src/threads.js?version=2023-10-29"></script>
        <script src="src/objects.js?version=2023-11-30"></script>
        <script src="src/scenes.js?version=2022-10-29"></script>
        <script src="src/gui.js?version=2023-12-05"></script>
        <script src="src/paint.js?version=2023-05-24"></script>
        <script src="src/lists.js?version=2023-07-24"></script>
        <script src="src/byob.js?version=2023-07-14"></script>
        <script src="src/tables.js?version=2023-07-05"></script>
        <script src="src/sketch.js?version=2023-05-24"></script>
        <script src="src/video.js?version=2019-06-27"></script>
        <script src="src/maps.js?version=2021-06-15"></script>
        <script src="src/extensions.js?version=2023-05-09"></script>
        <script src="src/xml.js?version=2021-07-05"></script>
        <script src="src/store.js?version=2023-07-27"></script>
        <script src="src/locale.js?version=2023-11-22"></script>
        <script src="src/cloud.js?version=2023-04-12"></script>
        <script src="src/api.js?version=2022-11-28"></script>
        <script src="src/sha512.js?version=2019-06-27"></script>
        <script src="src/FileSaver.min.js?version=2019-06-27"></script>
        <script>
            var world;
            window.onload = function () {
                // Polyfill for requestAnimationFrame
                (function() {
                    var lastTime = 0;
                    var vendors = ['ms', 'moz', 'webkit', 'o'];
                    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
                        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
                                                    || window[vendors[x]+'CancelRequestAnimationFrame'];
                    }

                    if (!window.requestAnimationFrame)
                        window.requestAnimationFrame = function(callback, element) {
                            var currTime = new Date().getTime();
                            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
                              timeToCall);
                            lastTime = currTime + timeToCall;
                            return id;
                        };

                    if (!window.cancelAnimationFrame)
                        window.cancelAnimationFrame = function(id) {
                            clearTimeout(id);
                        };
                }());

                var FPS = 67,
                    lastTime = 0,
                    loop;

                loop = function(timestamp) {
                    window.requestAnimationFrame(loop);
                    if (timestamp - lastTime < 1000 / FPS) {
                        return;
                    }
                    world.doOneCycle();
                    lastTime = Math.max(
                        lastTime + 1000 / FPS,
                        timestamp - 1000 / FPS
                    );
                };

                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('sw.js');
                }
                world = new WorldMorph(document.getElementById('world'));
                new IDE_Morph().openIn(world);
                window.requestAnimationFrame(loop);
            };
        </script>
    </head>
    <body style="margin: 0;">
        <canvas id="world" tabindex="1" style="position: absolute;"></canvas>
    </body>
</html>

